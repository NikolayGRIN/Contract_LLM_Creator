Contract LLM Creator (Offline)

Offline-система для анализа, структурирования и контролируемой генерации договорных документов с использованием локальной LLM.

---

Общее описание проекта

Contract LLM Creator — это offline-пайплайн для работы с реальными договорно-правовыми документами.  
Система предназначена для предобработки, структурного анализа и последующей генерации договоров без использования облачных сервисов и внешних API, что критически важно при работе с данными, составляющими коммерческую тайну юридических лиц.

Проект ориентирован на практическую юридическую NLP-задачу:
- сегментацию договоров на логические разделы (clauses),
- формирование структурированного корпуса договоров,
- контролируемую генерацию договорных разделов на основе реальной контрактной практики.

Цели проекта

Целью проекта является разработка сквозного оффлайн-пайплайна, который:

- обрабатывает и анализирует реальные договорные документы;
- сегментирует договоры на логические разделы;
- формирует локальный корпус контрактных клауз;
- генерирует новые договоры и их отдельные разделы по параметризованному пользовательскому запросу;
- поддерживает многоязычную генерацию (русский, английский, двуязычный RU / EN).

Основной функционал

1. Предобработка и сегментация договоров (реализовано)

- извлечение текста из DOCX-файлов (включая таблицы);
- очистка и нормализация договорного текста;
- выделение заголовков и сегментация на логические разделы;
- сопоставление заголовков с унифицированной типологией клауз;
- корпусный анализ качества сегментации.

Ключевые полученные файлы:
- `contracts_docx_healed`
- `segments.csv`
- `segments_report.csv`


2. Формирование локального корпуса договоров (реализовано)

- преобразование договоров в структурированные форматы (`corpus_sections.jsonl`);
- сохранение порядка разделов и метаданных;
- поддержка статистического и покрывного анализа корпуса;
- разделение физических документов и логических контрактных структур.


3. Retrieval-этап (BM25) (реализовано)

- лексико-статистический поиск релевантных прецедентов;
- фильтрация по типу секции (`payment_terms`, `delivery_terms`);
- диверсификация результатов (дедупликация, shingles);
- маскирование переменных из пользовательской формы.

Ключевой модуль: `src/retrieval/bm25.py`


4. Контролируемая генерация договоров с использованием локальной LLM (реализовано частично)

- генерация отдельных разделов договора (Payment Terms, Delivery Terms);
- строгая параметризация через `form_input.json`;
- поддержка русского и английского языков;
- генерация длинных юридических списков (20+ подпунктов);
- автоматическая валидация структуры и содержания;
- retry-механизм при нарушении требований.

Ключевые модули:
- `run_generate.py`
- `payment_terms_generate.py`
- `delivery_terms_generate.py`
- `*_validator.py`


5. Полностью оффлайн-инференс

- использование GGUF-модели (qwen2.5-7b-instruct-q4_k_m.gguf);
- backend: `llama-cpp-python`;
- запуск на CPU и GPU (локально и в Google Colab);
- отсутствие сетевых вызовов и внешних API.


Поддержка многоязычной генерации

Система поддерживает генерацию договорных разделов:

- на русском языке,
- на английском языке,
- с автоматическим выбором языка на основе параметра `language_mode` в `form_input.json`.

Язык влияет на:
- стиль генерации;
- юридическую лексику;
- форматы обязательств и структурные шаблоны.


Академический контекст

Проект разрабатывается в рамках итоговой работы по программе переподготовки и ориентирован на:

- прикладную обработку юридических текстов;
- корпусно-ориентированные методы анализа договоров;
- использование локальных LLM для контролируемой генерации юридических документов;
- сближение реальной договорной практики и автоматизированного контрактного моделирования.
